Provide a detailed explanation of the code, focusing on:

1. Overall purpose and functionality
2. Architecture and design decisions
3. Data flow and state management
4. Key algorithms and logic
5. Dependencies and integrations
6. Edge cases and error handling
7. Why the code is structured this way (not just what it does)

Explain in clear terms suitable for someone new to the codebase, but include technical depth where relevant.
